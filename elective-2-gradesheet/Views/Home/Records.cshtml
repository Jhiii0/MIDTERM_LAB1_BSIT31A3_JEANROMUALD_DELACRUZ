@using elective_2_gradesheet.Data.Entities
@model RecordsViewModel

@{
    ViewData["Title"] = "All Grade Records";
}

<div class="container mt-5">
    <h2 class="mb-4">All Grade Records</h2>

    <!-- Filter Form (remains the same) -->
    <form asp-action="Records" method="get" class="mb-4 p-3 border rounded">
        <div class="row g-3 align-items-end">
            <div class="col-md-4">
                <label class="form-label">Search by Name/Activity:</label>
                <input type="text" name="searchString" class="form-control" value="@Model.CurrentSearch" />
            </div>
            <div class="col-md-3">
                <label class="form-label">Filter by Section:</label>
                <select name="sectionId" asp-items="Model.Sections" class="form-control">
                    <option value="">All Sections</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Filter by Period:</label>
                <select name="period" asp-items="Html.GetEnumSelectList<GradingPeriod>()" class="form-control">
                    <option value="">All Periods</option>
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">Filter</button>
            </div>
        </div>
    </form>

    <!-- Data Table -->
    <div class="table-responsive">
        <table class="table table-striped table-bordered">
            <thead class="thead-dark">
                <tr>
                    <th>
                        <a asp-action="Records" asp-route-sortOrder="@ViewData["NameSortParm"]" asp-route-searchString="@Model.CurrentSearch" asp-route-sectionId="@Model.CurrentSectionId" asp-route-period="@Model.CurrentPeriod">Student Name</a>
                    </th>
                    <th>
                        <a asp-action="Records" asp-route-sortOrder="@ViewData["SectionSortParm"]" asp-route-searchString="@Model.CurrentSearch" asp-route-sectionId="@Model.CurrentSectionId" asp-route-period="@Model.CurrentPeriod">Section</a>
                    </th>
                    <th>Period</th>
                    <th>Activity Name</th>
                    <th>Status</th>
                    <th>Points</th>
                    <th>Max Points</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.Activities)
                {
                    <tr>
                        <td>
                            <!-- This is the corrected link -->
                            <a asp-action="StudentProfile" asp-route-id="@item.StudentId">@item.StudentFullName</a>
                        </td>
                        <td>@item.SectionName</td>
                        <td>@item.GradingPeriod</td>
                        <td>@item.ActivityName</td>
                        <td>@item.Status</td>
                        <td>@item.Points</td>
                        <td>@item.MaxPoints</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Pagination Controls (remains the same) -->
    @{
        var prevDisabled = !Model.Activities.HasPreviousPage ? "disabled" : "";
        var nextDisabled = !Model.Activities.HasNextPage ? "disabled" : "";
    }

    <a asp-action="Records"
       asp-route-sortOrder="@Model.CurrentSort"
       asp-route-pageNumber="@(Model.Activities.PageIndex - 1)"
       asp-route-searchString="@Model.CurrentSearch"
       asp-route-sectionId="@Model.CurrentSectionId"
       asp-route-period="@Model.CurrentPeriod"
       class="btn btn-outline-primary @prevDisabled">
        Previous
    </a>
    <a asp-action="Records"
       asp-route-sortOrder="@Model.CurrentSort"
       asp-route-pageNumber="@(Model.Activities.PageIndex + 1)"
       asp-route-searchString="@Model.CurrentSearch"
       asp-route-sectionId="@Model.CurrentSectionId"
       asp-route-period="@Model.CurrentPeriod"
       class="btn btn-outline-primary @nextDisabled">
        Next
    </a>
</div>
