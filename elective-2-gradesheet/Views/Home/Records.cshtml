@using elective_2_gradesheet.Data.Entities
@using elective_2_gradesheet.Helpers
@model RecordsViewModel

@{
    ViewData["Title"] = "All Grade Records";
}

<div class="container mt-5">
    <h2 class="mb-4">All Grade Records</h2>

    <!-- Filter Form -->
    <form asp-action="Records" method="get" class="mb-4 p-3 border rounded">
        <div class="row g-3 align-items-end">
            <div class="col-md-4">
                <label class="form-label">Search by Name/Activity:</label>
                <input type="text" name="searchString" class="form-control" value="@Model.CurrentSearch" />
            </div>
            <div class="col-md-3">
                <label class="form-label">Filter by Section:</label>
                <select name="sectionId" asp-items="Model.Sections" class="form-control">
                    <option value="">All Sections</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Filter by Period:</label>
                <select name="period" asp-items="Html.GetEnumSelectList<GradingPeriod>()" class="form-control">
                    <option value="">All Periods</option>
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">Filter</button>
            </div>
        </div>
    </form>

    <!-- Student Records Display -->
    @foreach (var studentGroup in Model.StudentGroups)
    {
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="mb-0">
                    <a asp-action="StudentProfile" asp-route-id="@studentGroup.StudentId">
                        @studentGroup.StudentFullName - @studentGroup.StudentNumber
                    </a>
                    <span class="badge bg-secondary float-end">@studentGroup.SectionName</span>
                </h5>
            </div>
            <div class="card-body p-0">
                @if (studentGroup.ActivitiesByPeriod.Any())
                {
                    @foreach (var periodGroup in studentGroup.ActivitiesByPeriod)
                    {
                        <div class="p-2 bg-light border-bottom">
                            <strong>@periodGroup.Key</strong>
                        </div>
                        <table class="table table-sm table-hover mb-0">
                            <tbody>
                                @foreach (var item in periodGroup.Value)
                                {
                                    <tr>
                                        <td>@item.ActivityName</td>
                                        <td>@item.Status</td>
                                        <td>@item.Points / @item.MaxPoints</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    }
                }
                else
                {
                    <p class="p-3 text-muted">No activities found for the selected filters.</p>
                }
            </div>
        </div>
    }

    <!-- Pagination Controls -->
    @{
        var prevDisabled = !Model.StudentGroups.HasPreviousPage ? "disabled" : "";
        var nextDisabled = !Model.StudentGroups.HasNextPage ? "disabled" : "";
    }
    <a asp-action="Records"
       asp-route-sortOrder="@Model.CurrentSort"
       asp-route-pageNumber="@(Model.StudentGroups.PageIndex - 1)"
       asp-route-searchString="@Model.CurrentSearch"
       asp-route-sectionId="@Model.CurrentSectionId"
       asp-route-period="@Model.CurrentPeriod"
       class="btn btn-outline-primary @prevDisabled">
        Previous
    </a>
    <a asp-action="Records"
       asp-route-sortOrder="@Model.CurrentSort"
       asp-route-pageNumber="@(Model.StudentGroups.PageIndex + 1)"
       asp-route-searchString="@Model.CurrentSearch"
       asp-route-sectionId="@Model.CurrentSectionId"
       asp-route-period="@Model.CurrentPeriod"
       class="btn btn-outline-primary @nextDisabled">
        Next
    </a>
</div>
